SET FOREIGN_KEY_CHECKS = 0;

DROP TABLE IF EXISTS SON_COMPRADOS;
DROP TABLE IF EXISTS PROVEEDORES;
DROP TABLE IF EXISTS CONSUMEN;
DROP TABLE IF EXISTS PRODUCTOS;
DROP TABLE IF EXISTS COCINAN;
DROP TABLE IF EXISTS RECETAS;
DROP TABLE IF EXISTS MESAS;
DROP TABLE IF EXISTS CAMAREROS;
DROP TABLE IF EXISTS COCINEROS;
DROP TABLE IF EXISTS EMPLEADOS;
DROP TABLE IF EXISTS RESERVAS;
DROP TABLE IF EXISTS CLIENTES;
DROP TABLE IF EXISTS RESTAURANTE;

SET FOREIGN_KEY_CHECKS = 1;

CREATE TABLE RESTAURANTE (
    NOMBRE VARCHAR(30),
    PRIMARY KEY (NOMBRE)
);

CREATE TABLE CLIENTES (
    NOMBRE VARCHAR(30),
    CORREO VARCHAR(50),
    TELEFONO BIGINT,
    DIRECCION VARCHAR(30),
    NOMBRE_RESTAURANTE VARCHAR(30),
    PRIMARY KEY (NOMBRE),
    FOREIGN KEY (NOMBRE_RESTAURANTE) REFERENCES RESTAURANTE(NOMBRE),
    CONSTRAINT CHK_CORREO_CLI CHECK (CORREO LIKE '%@%.%')
);

CREATE TABLE RESERVAS (
    CODIGO INT,
    NUMERO_PERSONA INT,
    ZONA VARCHAR(30),
    FECHA DATE,
    HORA TIME,
    NOMBRE VARCHAR(30),
    PRIMARY KEY (CODIGO),
    FOREIGN KEY (NOMBRE) REFERENCES CLIENTES(NOMBRE),
    CONSTRAINT CHK_PERS CHECK (NUMERO_PERSONA > 0)
);

CREATE TABLE EMPLEADOS (
    DNI VARCHAR(10),
    ROL VARCHAR(15),
    NOMBRE VARCHAR(30),
    SUELDO DECIMAL(10,2),
    EMAIL VARCHAR(50),
    DIRECCION VARCHAR(50),
    TELEFONO BIGINT,
    CUENTA_BANCARIA VARCHAR(30),
    NOMBRE_RESTAURANTE VARCHAR(30),
    PRIMARY KEY (DNI),
    FOREIGN KEY (NOMBRE_RESTAURANTE) REFERENCES RESTAURANTE(NOMBRE),
    CONSTRAINT CHK_SUELDO_EMP CHECK (SUELDO > 0)
);

CREATE TABLE COCINEROS (
    DNI VARCHAR(10),
    GRADO_COCINA VARCHAR(10),
    PRIMARY KEY (DNI),
    FOREIGN KEY (DNI) REFERENCES EMPLEADOS(DNI),
    CONSTRAINT CHK_GRADO_COC CHECK (GRADO_COCINA IN ('Baja', 'Media', 'Alta'))
);

CREATE TABLE CAMAREROS (
    DNI VARCHAR(10),
    ANIOS_TRABAJADOS INT,
    PRIMARY KEY (DNI),
    FOREIGN KEY (DNI) REFERENCES EMPLEADOS(DNI),
    CONSTRAINT CHK_ANIOS_CAM CHECK (ANIOS_TRABAJADOS >= 0)
);

CREATE TABLE MESAS (
    NUMERO INT,
    CODIGO INT,
    DNI VARCHAR(10),
    PRIMARY KEY (NUMERO),
    FOREIGN KEY (CODIGO) REFERENCES RESERVAS(CODIGO),
    FOREIGN KEY (DNI) REFERENCES CAMAREROS(DNI)
);

CREATE TABLE RECETAS (
    CODIGO INT,
    ALERGENOS VARCHAR(20),
    TIPO VARCHAR(20),
    PRIMARY KEY (CODIGO)
);

CREATE TABLE COCINAN (
    DNI VARCHAR(10),
    CODIGO INT,
    PRIMARY KEY (DNI, CODIGO),
    FOREIGN KEY (DNI) REFERENCES COCINEROS(DNI),
    FOREIGN KEY (CODIGO) REFERENCES RECETAS(CODIGO)
);

CREATE TABLE PRODUCTOS (
    ID INT,
    NOMBRE VARCHAR(30),
    PRECIO DECIMAL(10,2),
    STOCK INT,
    PRIMARY KEY (ID),
    CONSTRAINT CHK_PRECIO_PROD CHECK (PRECIO > 0),
    CONSTRAINT CHK_STOCK_PROD CHECK (STOCK >= 0)
);

CREATE TABLE CONSUMEN (
    CODIGO_RECETAS INT,
    ID INT,
    PRIMARY KEY (CODIGO_RECETAS, ID),
    FOREIGN KEY (CODIGO_RECETAS) REFERENCES RECETAS(CODIGO),
    FOREIGN KEY (ID) REFERENCES PRODUCTOS(ID)
);

CREATE TABLE PROVEEDORES (
    CIF VARCHAR(20),
    NOMBRE VARCHAR(30),
    DESCUENTO DECIMAL(10,2),
    FIABILIDAD VARCHAR(10),
    CUENTA_BANCARIA VARCHAR(30),
    PRIMARY KEY (CIF),
    CONSTRAINT CHK_FIAB_PROV CHECK (FIABILIDAD IN ('Baja', 'Media', 'Alta'))
);

CREATE TABLE SON_COMPRADOS (
    ID INT,
    CIF VARCHAR(20),
    PRIMARY KEY (ID, CIF),
    FOREIGN KEY (ID) REFERENCES PRODUCTOS(ID),
    FOREIGN KEY (CIF) REFERENCES PROVEEDORES(CIF)
);

INSERT INTO RESTAURANTE VALUES ('MC DONALD BARCELONA');
INSERT INTO RESTAURANTE VALUES ('MC DONALD VALENCIA');
INSERT INTO RESTAURANTE VALUES ('MC DONALD BILBAO');

INSERT INTO CLIENTES VALUES ('Juan Pérez', 'juan@gmail.com', 654321987, 'C/ Gran Vía 23', 'MC DONALD BARCELONA');
INSERT INTO CLIENTES VALUES ('Laura García', 'laura.g@gmail.com', 612987654, 'Av. Diagonal 56', 'MC DONALD VALENCIA');
INSERT INTO CLIENTES VALUES ('Pedro Martínez', 'pedro@hotmail.com', 678123456, 'C/ Mayor 7', 'MC DONALD BILBAO');

INSERT INTO RESERVAS VALUES (1, 3, 'Jardín', DATE '2026-01-23', DATE '2026-01-23', 'Juan Pérez');
INSERT INTO RESERVAS VALUES (2, 5, 'Salón', DATE '2026-01-25', DATE '2026-01-25', 'Laura García');
INSERT INTO RESERVAS VALUES (3, 4, 'Privado', DATE '2026-01-30', DATE '2026-01-30', 'Pedro Martínez');

INSERT INTO EMPLEADOS VALUES ('12345678A', 'Cocinero', 'María Fernández', 2000, 'maria@empresa.com', 'C/ Sol 15', 600987654, 'ES12345678', 'MC DONALD BARCELONA');
INSERT INTO EMPLEADOS VALUES ('87654321B', 'Camarero', 'José López', 1600, 'jose@empresa.com', 'C/ Luna 4', 611998877, 'ES87654321', 'MC DONALD BARCELONA');
INSERT INTO EMPLEADOS VALUES ('11223344C', 'Cocinero', 'Ana Rodríguez', 1850, 'ana@empresa.com', 'Av. Azul 33', 699112233, 'ES11223344', 'MC DONALD VALENCIA');

INSERT INTO COCINEROS VALUES ('12345678A', 'Alta');
INSERT INTO COCINEROS VALUES ('11223344C', 'Baja');

INSERT INTO CAMAREROS VALUES ('87654321B', 3);

INSERT INTO MESAS VALUES (20, 1, '87654321B');
INSERT INTO MESAS VALUES (21, 2, '87654321B');
INSERT INTO MESAS VALUES (22, 3, '87654321B');

INSERT INTO RECETAS VALUES (200, 'Nueces', 'Ensalada');
INSERT INTO RECETAS VALUES (201, 'Marisco', 'Pescado');
INSERT INTO RECETAS VALUES (202, 'Gluten', 'Pan');

INSERT INTO COCINAN VALUES ('12345678A', 200);
INSERT INTO COCINAN VALUES ('12345678A', 202);
INSERT INTO COCINAN VALUES ('11223344C', 201);

INSERT INTO PRODUCTOS VALUES (600, 'Tomate', 1.50, 60);
INSERT INTO PRODUCTOS VALUES (601, 'Queso', 2.30, 40);
INSERT INTO PRODUCTOS VALUES (602, 'Pescado', 15.00, 15);
INSERT INTO PRODUCTOS VALUES (603, 'Lechuga', 0.80, 90);

INSERT INTO CONSUMEN VALUES (200, 603);
INSERT INTO CONSUMEN VALUES (201, 602);
INSERT INTO CONSUMEN VALUES (202, 600);

INSERT INTO PROVEEDORES VALUES (8001, 'Verduras Norte', 4.00, 'Baja', 'ES80010001');
INSERT INTO PROVEEDORES VALUES (8002, 'Pescadería SL', 6.50, 'Alta', 'ES80020002');
INSERT INTO PROVEEDORES VALUES (8003, 'Lácteos SA', 2.00, 'Media', 'ES80030003');

INSERT INTO SON_COMPRADOS VALUES (600, 8001);
INSERT INTO SON_COMPRADOS VALUES (601, 8003);
INSERT INTO SON_COMPRADOS VALUES (602, 8002);
INSERT INTO SON_COMPRADOS VALUES (603, 8001);

UPDATE CLIENTES SET TELEFONO = 666666666 WHERE NOMBRE = 'Juan Pérez';
UPDATE PRODUCTOS SET PRECIO = 15.50 WHERE ID = 602;
UPDATE CLIENTES SET DIRECCION = 'C/ MATALLANA 10' WHERE NOMBRE = 'Laura García';
INSERT INTO PRODUCTOS (ID, NOMBRE, PRECIO, STOCK) VALUES (604, 'Tomate Frito', 1.30, 60);
INSERT INTO RECETAS (CODIGO, ALERGENOS, TIPO) VALUES (203, 'Ninguno', 'Ensalada');
UPDATE RESERVAS SET ZONA = 'Terraza Cubierta' WHERE CODIGO = 2;