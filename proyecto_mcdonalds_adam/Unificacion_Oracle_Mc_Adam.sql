ALTER SESSION SET "_ORACLE_SCRIPT"=TRUE;

DROP TABLE SON_COMPRADOS CASCADE CONSTRAINTS;
DROP TABLE PROVEEDORES CASCADE CONSTRAINTS;
DROP TABLE CONSUMEN CASCADE CONSTRAINTS;
DROP TABLE PRODUCTOS CASCADE CONSTRAINTS;
DROP TABLE COCINAN CASCADE CONSTRAINTS;
DROP TABLE RECETAS CASCADE CONSTRAINTS;
DROP TABLE MESAS CASCADE CONSTRAINTS;
DROP TABLE CAMAREROS CASCADE CONSTRAINTS;
DROP TABLE COCINEROS CASCADE CONSTRAINTS;
DROP TABLE EMPLEADOS CASCADE CONSTRAINTS;
DROP TABLE RESERVAS CASCADE CONSTRAINTS;
DROP TABLE CLIENTES CASCADE CONSTRAINTS;
DROP TABLE RESTAURANTE CASCADE CONSTRAINTS;

CREATE TABLE RESTAURANTE (
    NOMBRE VARCHAR2(30),
    CONSTRAINT PK_RESTAURANTE PRIMARY KEY (NOMBRE)
);

CREATE TABLE CLIENTES (
    NOMBRE VARCHAR2(30),
    CORREO VARCHAR2(50),
    TELEFONO NUMBER(10),
    DIRECCION VARCHAR2(30),
    NOMBRE_RESTAURANTE VARCHAR2(30),
    CONSTRAINT PK_CLIENTES PRIMARY KEY (NOMBRE),
    CONSTRAINT FK1_CLIENTES FOREIGN KEY (NOMBRE_RESTAURANTE) REFERENCES RESTAURANTE(NOMBRE),
    CONSTRAINT CHK_CORREO_CLI CHECK (CORREO LIKE '%@%.%')
);

CREATE TABLE RESERVAS (
    CODIGO NUMBER(10),
    NUMERO_PERSONA NUMBER(10),
    ZONA VARCHAR2(30),
    FECHA DATE,
    HORA DATE,
    NOMBRE VARCHAR2(30),
    CONSTRAINT PK_RESERVAS PRIMARY KEY (CODIGO),
    CONSTRAINT FK1_RESERVAS FOREIGN KEY (NOMBRE) REFERENCES CLIENTES(NOMBRE),
    CONSTRAINT CHK_PERS CHECK (NUMERO_PERSONA > 0)
);

CREATE TABLE EMPLEADOS (
    DNI VARCHAR2(10),
    ROL VARCHAR2(15),
    NOMBRE VARCHAR2(30),
    SUELDO NUMBER(10,2),
    EMAIL VARCHAR2(50),
    DIRECCION VARCHAR2(50),
    TELEFONO NUMBER(10),
    CUENTA_BANCARIA VARCHAR2(30),
    NOMBRE_RESTAURANTE VARCHAR2(30),
    CONSTRAINT PK_EMPLEADOS PRIMARY KEY (DNI),
    CONSTRAINT FK1_EMPLEADOS FOREIGN KEY (NOMBRE_RESTAURANTE) REFERENCES RESTAURANTE(NOMBRE),
    CONSTRAINT CHK_SUELDO_EMP CHECK (SUELDO > 0)
);

CREATE TABLE COCINEROS (
    DNI VARCHAR2(10),
    GRADO_COCINA VARCHAR2(10),
    CONSTRAINT PK_COCINEROS PRIMARY KEY (DNI),
    CONSTRAINT FK1_COCINEROS FOREIGN KEY (DNI) REFERENCES EMPLEADOS(DNI),
    CONSTRAINT CHK_GRADO_COC CHECK (GRADO_COCINA IN ('Baja', 'Media', 'Alta'))
);

CREATE TABLE CAMAREROS (
    DNI VARCHAR2(10),
    ANIOS_TRABAJADOS NUMBER(10),
    CONSTRAINT PK_CAMAREROS PRIMARY KEY (DNI),
    CONSTRAINT FK1_CAMAREROS FOREIGN KEY (DNI) REFERENCES EMPLEADOS(DNI),
    CONSTRAINT CHK_ANIOS_CAM CHECK (ANIOS_TRABAJADOS >= 0)
);

CREATE TABLE MESAS (
    NUMERO NUMBER(10),
    CODIGO NUMBER(10),
    DNI VARCHAR2(10),
    CONSTRAINT PK_MESAS PRIMARY KEY (NUMERO),
    CONSTRAINT FK1_MESAS FOREIGN KEY (CODIGO) REFERENCES RESERVAS(CODIGO),
    CONSTRAINT FK2_MESAS FOREIGN KEY (DNI) REFERENCES CAMAREROS(DNI)
);

CREATE TABLE RECETAS (
    CODIGO NUMBER(10),
    ALERGENOS VARCHAR2(20),
    TIPO VARCHAR2(20),
    CONSTRAINT PK_RECETAS PRIMARY KEY (CODIGO)
);

CREATE TABLE COCINAN (
    DNI VARCHAR2(10),
    CODIGO NUMBER(10),
    CONSTRAINT PK_COCINAN PRIMARY KEY (DNI, CODIGO),
    CONSTRAINT FK1_COCINAN FOREIGN KEY (DNI) REFERENCES COCINEROS(DNI),
    CONSTRAINT FK2_COCINAN FOREIGN KEY (CODIGO) REFERENCES RECETAS(CODIGO)
);

CREATE TABLE PRODUCTOS (
    ID NUMBER(10),
    NOMBRE VARCHAR2(30),
    PRECIO NUMBER(10,2),
    STOCK NUMBER(10),
    CONSTRAINT PK_PRODUCTOS PRIMARY KEY (ID),
    CONSTRAINT CHK_PRECIO_PROD CHECK (PRECIO > 0),
    CONSTRAINT CHK_STOCK_PROD CHECK (STOCK >= 0)
);

CREATE TABLE CONSUMEN (
    CODIGO_RECETAS NUMBER(10),
    ID NUMBER(10),
    CONSTRAINT PK_CONSUMEN PRIMARY KEY (CODIGO_RECETAS, ID),
    CONSTRAINT FK1_CONSUMEN FOREIGN KEY (CODIGO_RECETAS) REFERENCES RECETAS(CODIGO),
    CONSTRAINT FK2_CONSUMEN FOREIGN KEY (ID) REFERENCES PRODUCTOS(ID)
);

CREATE TABLE PROVEEDORES (
    CIF NUMBER(10),
    NOMBRE VARCHAR2(30),
    DESCUENTO NUMBER(10,2),
    FIABILIDAD VARCHAR2(10),
    CUENTA_BANCARIA VARCHAR2(30),
    CONSTRAINT PK_PROVEEDORES PRIMARY KEY (CIF),
    CONSTRAINT CHK_FIAB_PROV CHECK (FIABILIDAD IN ('Baja', 'Media', 'Alta'))
);

CREATE TABLE SON_COMPRADOS (
    ID NUMBER(10),
    CIF NUMBER(10),
    CONSTRAINT PK_SON_COMPRADOS PRIMARY KEY (ID, CIF),
    CONSTRAINT FK1_SON_COMPRADOS FOREIGN KEY (ID) REFERENCES PRODUCTOS(ID),
    CONSTRAINT FK2_SON_COMPRADOS FOREIGN KEY (CIF) REFERENCES PROVEEDORES(CIF)
);

INSERT INTO RESTAURANTE VALUES ('MC DONALD BARCELONA');
INSERT INTO RESTAURANTE VALUES ('MC DONALD VALENCIA');
INSERT INTO RESTAURANTE VALUES ('MC DONALD BILBAO');

INSERT INTO CLIENTES VALUES ('Juan Pérez', 'juan@gmail.com', 654321987, 'C/ Gran Vía 23', 'MC DONALD BARCELONA');
INSERT INTO CLIENTES VALUES ('Laura García', 'laura.g@gmail.com', 612987654, 'Av. Diagonal 56', 'MC DONALD VALENCIA');
INSERT INTO CLIENTES VALUES ('Pedro Martínez', 'pedro@hotmail.com', 678123456, 'C/ Mayor 7', 'MC DONALD BILBAO');

INSERT INTO RESERVAS VALUES (1, 3, 'Jardín', DATE '2026-01-23', DATE '2026-01-23', 'Juan Pérez');
INSERT INTO RESERVAS VALUES (2, 5, 'Salón', DATE '2026-01-25', DATE '2026-01-25', 'Laura García');
INSERT INTO RESERVAS VALUES (3, 4, 'Privado', DATE '2026-01-30', DATE '2026-01-30', 'Pedro Martínez');

INSERT INTO EMPLEADOS VALUES ('12345678A', 'Cocinero', 'María Fernández', 2000, 'maria@empresa.com', 'C/ Sol 15', 600987654, 'ES12345678', 'MC DONALD BARCELONA');
INSERT INTO EMPLEADOS VALUES ('87654321B', 'Camarero', 'José López', 1600, 'jose@empresa.com', 'C/ Luna 4', 611998877, 'ES87654321', 'MC DONALD BARCELONA');
INSERT INTO EMPLEADOS VALUES ('11223344C', 'Cocinero', 'Ana Rodríguez', 1850, 'ana@empresa.com', 'Av. Azul 33', 699112233, 'ES11223344', 'MC DONALD VALENCIA');

INSERT INTO COCINEROS VALUES ('12345678A', 'Alta');
INSERT INTO COCINEROS VALUES ('11223344C', 'Baja');

INSERT INTO CAMAREROS VALUES ('87654321B', 3);

INSERT INTO MESAS VALUES (20, 1, '87654321B');
INSERT INTO MESAS VALUES (21, 2, '87654321B');
INSERT INTO MESAS VALUES (22, 3, '87654321B');

INSERT INTO RECETAS VALUES (200, 'Nueces', 'Ensalada');
INSERT INTO RECETAS VALUES (201, 'Marisco', 'Pescado');
INSERT INTO RECETAS VALUES (202, 'Gluten', 'Pan');

INSERT INTO COCINAN VALUES ('12345678A', 200);
INSERT INTO COCINAN VALUES ('12345678A', 202);
INSERT INTO COCINAN VALUES ('11223344C', 201);

INSERT INTO PRODUCTOS VALUES (600, 'Tomate', 1.50, 60);
INSERT INTO PRODUCTOS VALUES (601, 'Queso', 2.30, 40);
INSERT INTO PRODUCTOS VALUES (602, 'Pescado', 15.00, 15);
INSERT INTO PRODUCTOS VALUES (603, 'Lechuga', 0.80, 90);

INSERT INTO CONSUMEN VALUES (200, 603);
INSERT INTO CONSUMEN VALUES (201, 602);
INSERT INTO CONSUMEN VALUES (202, 600);

INSERT INTO PROVEEDORES VALUES (8001, 'Verduras Norte', 4.00, 'Baja', 'ES80010001');
INSERT INTO PROVEEDORES VALUES (8002, 'Pescadería SL', 6.50, 'Alta', 'ES80020002');
INSERT INTO PROVEEDORES VALUES (8003, 'Lácteos SA', 2.00, 'Media', 'ES80030003');

INSERT INTO SON_COMPRADOS VALUES (600, 8001);
INSERT INTO SON_COMPRADOS VALUES (601, 8003);
INSERT INTO SON_COMPRADOS VALUES (602, 8002);
INSERT INTO SON_COMPRADOS VALUES (603, 8001);


UPDATE CLIENTES SET TELEFONO = 666666666 WHERE NOMBRE = 'Juan Pérez';

UPDATE PRODUCTOS SET PRECIO = 15.50 WHERE ID = 602;

UPDATE CLIENTES SET DIRECCION = 'C/ MATALLANA 10' WHERE NOMBRE = 'Laura García';

INSERT INTO PRODUCTOS (ID, NOMBRE, PRECIO, STOCK) VALUES (604, 'Tomate Frito', 1.30, 60);

INSERT INTO RECETAS (CODIGO, ALERGENOS, TIPO) VALUES (203, 'Ninguno', 'Ensalada');

UPDATE RESERVAS SET ZONA = 'Terraza Cubierta' WHERE CODIGO = 2;

COMMIT;

COMMIT;

SELECT * FROM RESTAURANTE;
SELECT * FROM CLIENTES;
SELECT * FROM RESERVAS;
SELECT * FROM EMPLEADOS;
SELECT * FROM COCINEROS;
SELECT * FROM CAMAREROS;
SELECT * FROM MESAS;
SELECT * FROM RECETAS;
SELECT * FROM COCINAN;
SELECT * FROM PRODUCTOS;
SELECT * FROM CONSUMEN;
SELECT * FROM PROVEEDORES;
SELECT * FROM SON_COMPRADOS;