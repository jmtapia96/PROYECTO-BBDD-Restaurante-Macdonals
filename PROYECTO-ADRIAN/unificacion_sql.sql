ALTER SESSION SET "_ORACLE_SCRIPT"=TRUE;

DROP TABLE SON_COMPRADOS CASCADE CONSTRAINTS;
DROP TABLE PROVEEDORES CASCADE CONSTRAINTS;
DROP TABLE CONSUMEN CASCADE CONSTRAINTS;
DROP TABLE PRODUCTOS CASCADE CONSTRAINTS;
DROP TABLE COCINAN CASCADE CONSTRAINTS;
DROP TABLE RECETAS CASCADE CONSTRAINTS;
DROP TABLE MESAS CASCADE CONSTRAINTS;
DROP TABLE CAMAREROS CASCADE CONSTRAINTS;
DROP TABLE COCINEROS CASCADE CONSTRAINTS;
DROP TABLE EMPLEADOS CASCADE CONSTRAINTS;
DROP TABLE RESERVAS CASCADE CONSTRAINTS;
DROP TABLE CLIENTES CASCADE CONSTRAINTS;
DROP TABLE RESTAURANTE CASCADE CONSTRAINTS;

CREATE TABLE RESTAURANTE (
    NOMBRE VARCHAR2(30),
    CONSTRAINT PK_RESTAURANTE PRIMARY KEY (NOMBRE)
);

CREATE TABLE CLIENTES (
    NOMBRE VARCHAR2(30),
    CORREO VARCHAR2(50),
    TELEFONO NUMBER(10),
    DIRECCION VARCHAR2(30),
    NOMBRE_RESTAURANTE VARCHAR2(30),
    CONSTRAINT PK_CLIENTES PRIMARY KEY (NOMBRE),
    CONSTRAINT FK1_CLIENTES FOREIGN KEY (NOMBRE_RESTAURANTE) REFERENCES RESTAURANTE(NOMBRE),
    CONSTRAINT CHK_CORREO_CLI CHECK (CORREO LIKE '%@%.%')
);

CREATE TABLE RESERVAS (
    CODIGO NUMBER(10),
    NUMERO_PERSONA NUMBER(10),
    ZONA VARCHAR2(30),
    FECHA DATE,
    HORA DATE,
    NOMBRE VARCHAR2(30),
    CONSTRAINT PK_RESERVAS PRIMARY KEY (CODIGO),
    CONSTRAINT FK1_RESERVAS FOREIGN KEY (NOMBRE) REFERENCES CLIENTES(NOMBRE),
    CONSTRAINT CHK_PERS CHECK (NUMERO_PERSONA > 0)
);

CREATE TABLE EMPLEADOS (
    DNI VARCHAR2(10),
    ROL VARCHAR2(15),
    NOMBRE VARCHAR2(30),
    SUELDO NUMBER(10,2),
    EMAIL VARCHAR2(50),
    DIRECCION VARCHAR2(50),
    TELEFONO NUMBER(10),
    CUENTA_BANCARIA VARCHAR2(30),
    NOMBRE_RESTAURANTE VARCHAR2(30),
    CONSTRAINT PK_EMPLEADOS PRIMARY KEY (DNI),
    CONSTRAINT FK1_EMPLEADOS FOREIGN KEY (NOMBRE_RESTAURANTE) REFERENCES RESTAURANTE(NOMBRE),
    CONSTRAINT CHK_SUELDO_EMP CHECK (SUELDO > 0)
);

CREATE TABLE COCINEROS (
    DNI VARCHAR2(10),
    GRADO_COCINA VARCHAR2(10),
    CONSTRAINT PK_COCINEROS PRIMARY KEY (DNI),
    CONSTRAINT FK1_COCINEROS FOREIGN KEY (DNI) REFERENCES EMPLEADOS(DNI),
    CONSTRAINT CHK_GRADO_COC CHECK (GRADO_COCINA IN ('Baja', 'Media', 'Alta'))
);

CREATE TABLE CAMAREROS (
    DNI VARCHAR2(10),
    ANIOS_TRABAJADOS NUMBER(10),
    CONSTRAINT PK_CAMAREROS PRIMARY KEY (DNI),
    CONSTRAINT FK1_CAMAREROS FOREIGN KEY (DNI) REFERENCES EMPLEADOS(DNI),
    CONSTRAINT CHK_ANIOS_CAM CHECK (ANIOS_TRABAJADOS >= 0)
);

CREATE TABLE MESAS (
    NUMERO NUMBER(10),
    CODIGO NUMBER(10),
    DNI VARCHAR2(10),
    CONSTRAINT PK_MESAS PRIMARY KEY (NUMERO),
    CONSTRAINT FK1_MESAS FOREIGN KEY (CODIGO) REFERENCES RESERVAS(CODIGO),
    CONSTRAINT FK2_MESAS FOREIGN KEY (DNI) REFERENCES CAMAREROS(DNI)
);

CREATE TABLE RECETAS (
    CODIGO NUMBER(10),
    ALERGENOS VARCHAR2(20),
    TIPO VARCHAR2(20),
    CONSTRAINT PK_RECETAS PRIMARY KEY (CODIGO)
);

CREATE TABLE COCINAN (
    DNI VARCHAR2(10),
    CODIGO NUMBER(10),
    CONSTRAINT PK_COCINAN PRIMARY KEY (DNI, CODIGO),
    CONSTRAINT FK1_COCINAN FOREIGN KEY (DNI) REFERENCES COCINEROS(DNI),
    CONSTRAINT FK2_COCINAN FOREIGN KEY (CODIGO) REFERENCES RECETAS(CODIGO)
);

CREATE TABLE PRODUCTOS (
    ID NUMBER(10),
    NOMBRE VARCHAR2(30),
    PRECIO NUMBER(10,2),
    STOCK NUMBER(10),
    CONSTRAINT PK_PRODUCTOS PRIMARY KEY (ID),
    CONSTRAINT CHK_PRECIO_PROD CHECK (PRECIO > 0),
    CONSTRAINT CHK_STOCK_PROD CHECK (STOCK >= 0)
);

CREATE TABLE CONSUMEN (
    CODIGO_RECETAS NUMBER(10),
    ID NUMBER(10),
    CONSTRAINT PK_CONSUMEN PRIMARY KEY (CODIGO_RECETAS, ID),
    CONSTRAINT FK1_CONSUMEN FOREIGN KEY (CODIGO_RECETAS) REFERENCES RECETAS(CODIGO),
    CONSTRAINT FK2_CONSUMEN FOREIGN KEY (ID) REFERENCES PRODUCTOS(ID)
);

CREATE TABLE PROVEEDORES (
    CIF NUMBER(10),
    NOMBRE VARCHAR2(30),
    DESCUENTO NUMBER(10,2),
    FIABILIDAD VARCHAR2(10),
    CUENTA_BANCARIA VARCHAR2(30),
    CONSTRAINT PK_PROVEEDORES PRIMARY KEY (CIF),
    CONSTRAINT CHK_FIAB_PROV CHECK (FIABILIDAD IN ('Baja', 'Media', 'Alta'))
);

CREATE TABLE SON_COMPRADOS (
    ID NUMBER(10),
    CIF NUMBER(10),
    CONSTRAINT PK_SON_COMPRADOS PRIMARY KEY (ID, CIF),
    CONSTRAINT FK1_SON_COMPRADOS FOREIGN KEY (ID) REFERENCES PRODUCTOS(ID),
    CONSTRAINT FK2_SON_COMPRADOS FOREIGN KEY (CIF) REFERENCES PROVEEDORES(CIF)
);

INSERT INTO RESTAURANTE VALUES ('MC DONALD SEVILLA');
INSERT INTO RESTAURANTE VALUES ('MC DONALD MADRID');
INSERT INTO RESTAURANTE VALUES ('MC DONALD CORDOBA');

INSERT INTO CLIENTES VALUES ('Carlos Ruiz', 'carlos@gmail.com', 654789123, 'C/ La Vega 12', 'MC DONALD SEVILLA');
INSERT INTO CLIENTES VALUES ('Ana Torres', 'ana.t@gmail.com', 612345987, 'Av. España 45', 'MC DONALD MADRID');
INSERT INTO CLIENTES VALUES ('María López', 'mlopez@hotmail.com', 678912345, 'C/ Sol 8', 'MC DONALD CORDOBA');

INSERT INTO RESERVAS VALUES (1, 4, 'Terraza', TO_DATE('2025-05-12', 'YYYY-MM-DD'), TO_DATE('2025-05-12', 'YYYY-MM-DD'), 'Carlos Ruiz');
INSERT INTO RESERVAS VALUES (2, 2, 'Interior', TO_DATE('2025-05-15', 'YYYY-MM-DD'), TO_DATE('2025-05-15', 'YYYY-MM-DD'), 'Ana Torres');
INSERT INTO RESERVAS VALUES (3, 6, 'VIP', TO_DATE('2025-05-20', 'YYYY-MM-DD'), TO_DATE('2025-05-20', 'YYYY-MM-DD'), 'María López');

INSERT INTO EMPLEADOS VALUES ('11111111A', 'Cocinero', 'Luis Gómez', 1800, 'luis@em.com', 'C/ Luna 3', 600123456, 'ES11111111', 'MC DONALD SEVILLA');
INSERT INTO EMPLEADOS VALUES ('22222222B', 'Camarero', 'Pedro Sánchez', 1500, 'pedro@em.com', 'C/ Olivo 9', 611223344, 'ES22222222', 'MC DONALD SEVILLA');
INSERT INTO EMPLEADOS VALUES ('33333333C', 'Cocinero', 'Sofía Martín', 1900, 'sofia@em.com', 'Av. Verde 22', 699887766, 'ES33333333', 'MC DONALD MADRID');

INSERT INTO COCINEROS VALUES ('11111111A', 'Alta');
INSERT INTO COCINEROS VALUES ('33333333C', 'Media');

INSERT INTO CAMAREROS VALUES ('22222222B', 5);

INSERT INTO MESAS VALUES (10, 1, '22222222B');
INSERT INTO MESAS VALUES (11, 2, '22222222B');
INSERT INTO MESAS VALUES (12, 3, '22222222B');

INSERT INTO RECETAS VALUES (100, 'Gluten', 'Carne');
INSERT INTO RECETAS VALUES (101, 'Lactosa', 'Postre');
INSERT INTO RECETAS VALUES (102, 'Ninguno', 'Pasta');

INSERT INTO COCINAN VALUES ('11111111A', 100);
INSERT INTO COCINAN VALUES ('11111111A', 102);
INSERT INTO COCINAN VALUES ('33333333C', 101);

INSERT INTO PRODUCTOS VALUES (500, 'Harina', 1.20, 50);
INSERT INTO PRODUCTOS VALUES (501, 'Leche', 0.90, 80);
INSERT INTO PRODUCTOS VALUES (502, 'Carne Vacuno', 12.50, 20);
INSERT INTO PRODUCTOS VALUES (503, 'Pasta', 1.10, 100);

INSERT INTO CONSUMEN VALUES (100, 502);
INSERT INTO CONSUMEN VALUES (101, 501);
INSERT INTO CONSUMEN VALUES (102, 503);

INSERT INTO PROVEEDORES VALUES (9001, 'Distribuciones Sur', 5.00, 'Alta', 'ES90010001');
INSERT INTO PROVEEDORES VALUES (9002, 'Alimentos Martínez', 3.50, 'Media', 'ES90020002');
INSERT INTO PROVEEDORES VALUES (9003, 'Cárnicas López', 7.00, 'Alta', 'ES90030003');

INSERT INTO SON_COMPRADOS VALUES (500, 9001);
INSERT INTO SON_COMPRADOS VALUES (501, 9001);
INSERT INTO SON_COMPRADOS VALUES (502, 9003);
INSERT INTO SON_COMPRADOS VALUES (503, 9002);

UPDATE CLIENTES SET TELEFONO = 666666666 WHERE NOMBRE = 'Carlos Ruiz';

UPDATE PRODUCTOS SET PRECIO = 15.50 WHERE ID = 502;

UPDATE CLIENTES SET DIRECCION = 'C/ MATALLANA 10' WHERE NOMBRE = 'Ana Torres';

INSERT INTO PRODUCTOS (ID, NOMBRE, PRECIO, STOCK) VALUES (504, 'Tomate Frito', 1.30, 60);

INSERT INTO RECETAS (CODIGO, ALERGENOS, TIPO) VALUES (103, 'Ninguno', 'Ensalada');

UPDATE RESERVAS SET ZONA = 'Terraza Cubierta' WHERE CODIGO = 2;

COMMIT;

COMMIT;

SELECT * FROM RESTAURANTE;
SELECT * FROM CLIENTES;
SELECT * FROM RESERVAS;
SELECT * FROM EMPLEADOS;
SELECT * FROM COCINEROS;
SELECT * FROM CAMAREROS;
SELECT * FROM MESAS;
SELECT * FROM RECETAS;
SELECT * FROM COCINAN;
SELECT * FROM PRODUCTOS;
SELECT * FROM CONSUMEN;
SELECT * FROM PROVEEDORES;
SELECT * FROM SON_COMPRADOS;