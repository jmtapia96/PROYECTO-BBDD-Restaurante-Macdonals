SET FOREIGN_KEY_CHECKS = 0;

DROP TABLE IF EXISTS SON_COMPRADOS;
DROP TABLE IF EXISTS PROVEEDORES;
DROP TABLE IF EXISTS CONSUMEN;
DROP TABLE IF EXISTS PRODUCTOS;
DROP TABLE IF EXISTS COCINAN;
DROP TABLE IF EXISTS RECETAS;
DROP TABLE IF EXISTS MESAS;
DROP TABLE IF EXISTS CAMAREROS;
DROP TABLE IF EXISTS COCINEROS;
DROP TABLE IF EXISTS EMPLEADOS;
DROP TABLE IF EXISTS RESERVAS;
DROP TABLE IF EXISTS CLIENTES;
DROP TABLE IF EXISTS RESTAURANTE;

SET FOREIGN_KEY_CHECKS = 1;

CREATE TABLE RESTAURANTE (
    NOMBRE VARCHAR(30),
    PRIMARY KEY (NOMBRE)
);

CREATE TABLE CLIENTES (
    NOMBRE VARCHAR(30),
    CORREO VARCHAR(50),
    TELEFONO BIGINT,
    DIRECCION VARCHAR(30),
    NOMBRE_RESTAURANTE VARCHAR(30),
    PRIMARY KEY (NOMBRE),
    FOREIGN KEY (NOMBRE_RESTAURANTE) REFERENCES RESTAURANTE(NOMBRE),
    CONSTRAINT CHK_CORREO_CLI CHECK (CORREO LIKE '%@%.%')
);

CREATE TABLE RESERVAS (
    CODIGO INT,
    NUMERO_PERSONA INT,
    ZONA VARCHAR(30),
    FECHA DATE,
    HORA TIME,
    NOMBRE VARCHAR(30),
    PRIMARY KEY (CODIGO),
    FOREIGN KEY (NOMBRE) REFERENCES CLIENTES(NOMBRE),
    CONSTRAINT CHK_PERS CHECK (NUMERO_PERSONA > 0)
);

CREATE TABLE EMPLEADOS (
    DNI VARCHAR(10),
    ROL VARCHAR(15),
    NOMBRE VARCHAR(30),
    SUELDO DECIMAL(10,2),
    EMAIL VARCHAR(50),
    DIRECCION VARCHAR(50),
    TELEFONO BIGINT,
    CUENTA_BANCARIA VARCHAR(30),
    NOMBRE_RESTAURANTE VARCHAR(30),
    PRIMARY KEY (DNI),
    FOREIGN KEY (NOMBRE_RESTAURANTE) REFERENCES RESTAURANTE(NOMBRE),
    CONSTRAINT CHK_SUELDO_EMP CHECK (SUELDO > 0)
);

CREATE TABLE COCINEROS (
    DNI VARCHAR(10),
    GRADO_COCINA VARCHAR(10),
    PRIMARY KEY (DNI),
    FOREIGN KEY (DNI) REFERENCES EMPLEADOS(DNI),
    CONSTRAINT CHK_GRADO_COC CHECK (GRADO_COCINA IN ('Baja', 'Media', 'Alta'))
);

CREATE TABLE CAMAREROS (
    DNI VARCHAR(10),
    ANIOS_TRABAJADOS INT,
    PRIMARY KEY (DNI),
    FOREIGN KEY (DNI) REFERENCES EMPLEADOS(DNI),
    CONSTRAINT CHK_ANIOS_CAM CHECK (ANIOS_TRABAJADOS >= 0)
);

CREATE TABLE MESAS (
    NUMERO INT,
    CODIGO INT,
    DNI VARCHAR(10),
    PRIMARY KEY (NUMERO),
    FOREIGN KEY (CODIGO) REFERENCES RESERVAS(CODIGO),
    FOREIGN KEY (DNI) REFERENCES CAMAREROS(DNI)
);

CREATE TABLE RECETAS (
    CODIGO INT,
    ALERGENOS VARCHAR(20),
    TIPO VARCHAR(20),
    PRIMARY KEY (CODIGO)
);

CREATE TABLE COCINAN (
    DNI VARCHAR(10),
    CODIGO INT,
    PRIMARY KEY (DNI, CODIGO),
    FOREIGN KEY (DNI) REFERENCES COCINEROS(DNI),
    FOREIGN KEY (CODIGO) REFERENCES RECETAS(CODIGO)
);

CREATE TABLE PRODUCTOS (
    ID INT,
    NOMBRE VARCHAR(30),
    PRECIO DECIMAL(10,2),
    STOCK INT,
    PRIMARY KEY (ID),
    CONSTRAINT CHK_PRECIO_PROD CHECK (PRECIO > 0),
    CONSTRAINT CHK_STOCK_PROD CHECK (STOCK >= 0)
);

CREATE TABLE CONSUMEN (
    CODIGO_RECETAS INT,
    ID INT,
    PRIMARY KEY (CODIGO_RECETAS, ID),
    FOREIGN KEY (CODIGO_RECETAS) REFERENCES RECETAS(CODIGO),
    FOREIGN KEY (ID) REFERENCES PRODUCTOS(ID)
);

CREATE TABLE PROVEEDORES (
    CIF VARCHAR(20),
    NOMBRE VARCHAR(30),
    DESCUENTO DECIMAL(10,2),
    FIABILIDAD VARCHAR(10),
    CUENTA_BANCARIA VARCHAR(30),
    PRIMARY KEY (CIF),
    CONSTRAINT CHK_FIAB_PROV CHECK (FIABILIDAD IN ('Baja', 'Media', 'Alta'))
);

CREATE TABLE SON_COMPRADOS (
    ID INT,
    CIF VARCHAR(20),
    PRIMARY KEY (ID, CIF),
    FOREIGN KEY (ID) REFERENCES PRODUCTOS(ID),
    FOREIGN KEY (CIF) REFERENCES PROVEEDORES(CIF)
);

INSERT INTO RESTAURANTE VALUES ('MC DONALD SEVILLA');
INSERT INTO RESTAURANTE VALUES ('MC DONALD MADRID');
INSERT INTO RESTAURANTE VALUES ('MC DONALD CORDOBA');

INSERT INTO CLIENTES VALUES ('Carlos Ruiz', 'carlos@gmail.com', 654789123, 'C/ La Vega 12', 'MC DONALD SEVILLA');
INSERT INTO CLIENTES VALUES ('Ana Torres', 'ana.t@gmail.com', 612345987, 'Av. España 45', 'MC DONALD MADRID');
INSERT INTO CLIENTES VALUES ('María López', 'mlopez@hotmail.com', 678912345, 'C/ Sol 8', 'MC DONALD CORDOBA');

INSERT INTO RESERVAS VALUES (1, 4, 'Terraza', '2025-05-12', '14:00:00', 'Carlos Ruiz');
INSERT INTO RESERVAS VALUES (2, 2, 'Interior', '2025-05-15', '21:30:00', 'Ana Torres');
INSERT INTO RESERVAS VALUES (3, 6, 'VIP', '2025-05-20', '22:00:00', 'María López');

INSERT INTO EMPLEADOS VALUES ('11111111A', 'Cocinero', 'Luis Gómez', 1800, 'luis@em.com', 'C/ Luna 3', 600123456, 'ES11111111', 'MC DONALD SEVILLA');
INSERT INTO EMPLEADOS VALUES ('22222222B', 'Camarero', 'Pedro Sánchez', 1500, 'pedro@em.com', 'C/ Olivo 9', 611223344, 'ES22222222', 'MC DONALD SEVILLA');
INSERT INTO EMPLEADOS VALUES ('33333333C', 'Cocinero', 'Sofía Martín', 1900, 'sofia@em.com', 'Av. Verde 22', 699887766, 'ES33333333', 'MC DONALD MADRID');

INSERT INTO COCINEROS VALUES ('11111111A', 'Alta');
INSERT INTO COCINEROS VALUES ('33333333C', 'Media');

INSERT INTO CAMAREROS VALUES ('22222222B', 5);

INSERT INTO MESAS VALUES (10, 1, '22222222B');
INSERT INTO MESAS VALUES (11, 2, '22222222B');
INSERT INTO MESAS VALUES (12, 3, '22222222B');

INSERT INTO RECETAS VALUES (100, 'Gluten', 'Carne');
INSERT INTO RECETAS VALUES (101, 'Lactosa', 'Postre');
INSERT INTO RECETAS VALUES (102, 'Ninguno', 'Pasta');

INSERT INTO COCINAN VALUES ('11111111A', 100);
INSERT INTO COCINAN VALUES ('11111111A', 102);
INSERT INTO COCINAN VALUES ('33333333C', 101);

INSERT INTO PRODUCTOS VALUES (500, 'Harina', 1.20, 50);
INSERT INTO PRODUCTOS VALUES (501, 'Leche', 0.90, 80);
INSERT INTO PRODUCTOS VALUES (502, 'Carne Vacuno', 12.50, 20);
INSERT INTO PRODUCTOS VALUES (503, 'Pasta', 1.10, 100);

INSERT INTO CONSUMEN VALUES (100, 502);
INSERT INTO CONSUMEN VALUES (101, 501);
INSERT INTO CONSUMEN VALUES (102, 503);

INSERT INTO PROVEEDORES VALUES ('9001', 'Distribuciones Sur', 5.00, 'Alta', 'ES90010001');
INSERT INTO PROVEEDORES VALUES ('9002', 'Alimentos Martínez', 3.50, 'Media', 'ES90020002');
INSERT INTO PROVEEDORES VALUES ('9003', 'Cárnicas López', 7.00, 'Alta', 'ES90030003');

INSERT INTO SON_COMPRADOS VALUES (500, '9001');
INSERT INTO SON_COMPRADOS VALUES (501, '9001');
INSERT INTO SON_COMPRADOS VALUES (502, '9003');
INSERT INTO SON_COMPRADOS VALUES (503, '9002');

UPDATE CLIENTES SET TELEFONO = 666666666 WHERE NOMBRE = 'Carlos Ruiz';
UPDATE PRODUCTOS SET PRECIO = 15.50 WHERE ID = 502;
UPDATE CLIENTES SET DIRECCION = 'C/ MATALLANA 10' WHERE NOMBRE = 'Ana Torres';
INSERT INTO PRODUCTOS VALUES (504, 'Tomate Frito', 1.30, 60);
INSERT INTO RECETAS VALUES (103, 'Ninguno', 'Ensalada');
UPDATE RESERVAS SET ZONA = 'Terraza Cubierta' WHERE CODIGO = 2;